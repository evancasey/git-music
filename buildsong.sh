!/bin/bash
# ./buildsong.sh tmp/railsrails.txt output.mp3 drake

# TODO: change later
COMMITS_AUDIO_PATH=${1:0:14}.aiff

cat $1 | say -o $COMMITS_AUDIO_PATH

DRAKE_MIDI="midi/drake-midi.txt"
DRAKE_INSTRUMENTAL="audio/drake_lower.mp3"

SONIC_ACCESS_ID=6cf9eac8-de22-4190-8813-ee13df780350

# upload commits audio 
#RESPONSE=$(curl -F input_file=@tmp/drake-temp.aiff 'https://api.sonicapi.com/process/elastiqueTune?access_id=6cf9eac8-de22-4190-8813-ee13df780350&format=json&blocking=false&midi_pitches=19.22641-61.64844-61.34075-60.76478-59.74565-60.41334-57.09715-54.28538-52.46444-53.50328-59.01312-59.22527-58.03454-61.42479-60.58971-60.52517-59.60167-60.16223-57.08269-54.13479-52.48125-59.10554-60.74766-59.11786-58.95978-56.98070-59.00828-23.09548-60.90243-61.04739-22.92360-22.98767-22.97594-58.81538-52.10954-57.02211-56.93594-59.03252-33.13257-32.98181-58.97594-58.67203-33.03121-34.56465-33.06095-28.38338-58.93566-56.89578-57.01109-57.10438-28.01099-27.90608-59.05677-60.75169-58.99621-47.96005-25.29382-26.02940-25.95026-25.96936-59.00828-25.62177-59.65039-60.90243-26.71955-34.48926-33.14172-56.97762-59.05677-30.01497-30.09307-34.72744-32.32280-58.87552-59.12179-27.82839-56.90999-57.19149-28.06701-28.16420-60.74097-32.80868-37.86954-22.99610-22.98398-59.32701-60.90243-23.02189-22.82432-22.98701-59.35104-23.08161-56.80291-32.98099-33.05593-33.02849-34.66809-33.05012-27.91622-27.96245-29.73027-28.03320-28.04147-59.22787-61.01097-58.79160-29.00499-25.99458-58.91156-25.56499-60.88452-25.84108-25.96933-26.03420-25.91916-26.08339-59.04069-60.71417-58.94054-34.85560-32.97452-57.08269-29.96554-34.73637-33.48901-28.02642-40.02103-27.98334-59.22787-56.03698-54.43228-58.95978-58.73606-60.47511-59.12181-59.12991-58.95978-22.81369-23.01731-22.79141-22.89753-22.98028-59.58183-60.98402-58.87539-58.98057-57.06232-59.05677-59.10065-33.02494-33.04859-33.00333-35.03320-32.98529-27.99441-27.92234-27.95908-60.68759-62.01209-28.01412-27.99679-58.95978-28.11971-58.97594-26.16149-59.10553-59.10553-59.05691-59.00827-26.04141-25.99813-25.98372-26.02337-26.07517-58.79140-61.12020-26.01980-59.04069-58.95978-33.09358-29.90127-55.99997-55.90851-30.05516-54.02776-29.98693-52.02104-29.96731-34.79169-33.46306-57.36703-56.00343-28.24190-54.00969-51.97256-52.00498-46.98440-47.21148-58.93593-60.92957-57.30121-59.04060-22.94169-60.99289-22.92959-22.95579-23.02969-59.13814-22.98038-58.95978-59.10554-23.13636-56.94074-56.83854-58.92763-33.00691-32.99396-59.15430-32.97240-34.66190-33.06637-27.94025-59.05676-28.61524-56.94221-57.05376-28.05346-28.05920-59.08946-60.95682-58.97203-29.48352-56.90999-25.66033-25.99303-25.98853-25.98411-58.95978-25.85824-34.70317-33.00849-58.87968-29.85599-30.72513-59.00828-30.12814-34.63303-32.85281-59.05676-59.05677-27.94947-28.04539-56.20159-60.84850-61.12020-59.05704-45.53002-56.97454-23.03551-59.12179-23.01734-60.92414-23.00823-22.97432-22.91753-22.91774-59.17882-23.07637-56.75318-33.05448-34.11862-33.12807-32.95301-34.43431-33.12271-27.85371-28.03328-28.02512-28.08629-60.71071-58.94961-28.57183-25.72052-60.92957-61.01097-25.96818-26.03179-25.95736-25.74097-61.23012-59.03265-34.62358-33.11885-56.91085-30.03405-31.00020-30.11014-30.03092-34.78096-32.91041-27.97658-28.02918-59.27705-28.12661-58.95986-58.98443-59.23277-50.21293-60.87547-59.08937-59.05677-22.96785-72.98954-22.97390-22.90153-23.00222-22.93916-59.08946-59.03266-59.01280-58.94398-29.76546-40.91183-33.03305-34.64271-33.00687-28.00812-28.04262-62.02961-28.03190-58.88771-29.92430-27.95656-25.75398-26.01336-25.94778-26.01795-26.04863-59.37584-26.03792-59.04464-59.05677-33.09931-55.94541-30.12523-53.93107-42.05207-29.96562-35.01437-32.98383-48.95553-53.77513-40.01293-51.91614-52.10872-47.05695-62.33051-47.52505-47.12265-23.02385-23.00367-22.15135-22.90249-22.99994-23.04468-33.20860-32.99185-32.97093-56.80291-32.92878-34.80916-33.07179-28.01904-27.99270-61.01098-60.95671-57.08269-28.08847-26.04885-25.96936-26.07282-25.99096-26.03061-25.99209-26.11039-25.66119-25.99763-65.58663-33.70137-29.97839-34.97794-32.91532-39.94025-28.01091-28.00084-28.04127-39.87614-28.26257-28.07136-65.59673-65.48366-33.02429-25.53464-23.16066-22.98251-22.99335-22.22108-23.02536-33.00994-34.84624-33.05013-27.97520-27.29164-61.01098-61.01097-28.19772-47.34856-28.04944-28.98246-26.03239-25.93656-26.19383-26.06549-26.01123-25.84770-26.03429-26.00956-65.59673-34.92437-33.05014-29.93307-30.00658-30.04903-58.96670-34.98399-32.87178-27.97791-28.03454-27.95638-32.12819-28.11323-25.34154-23.04322-59.00827-59.15430-22.97801-58.99211-23.05186-60.92957-59.31266-23.03492-33.02418-59.05677-33.02640-34.67943-33.04471-27.82844-27.98545-27.95315-28.00363-60.31814-59.00827-59.05676-59.13038-58.94049-58.93117-38.20134-59.33507-60.85711-61.01098-60.83652-25.92623-25.95980-25.95323-25.94060-60.84877-61.85946-60.90243-32.13393-29.91456-63.69084-65.66238-60.96756-59.10554-61.02918-59.05149-58.92776-58.86333-59.01315-34.48886-32.92104-34.87540-28.08052-35.19332-27.96580-60.82713-61.95483-28.13178-61.70530-61.55266-59.16683-60.73272-58.98753-57.46476-58.87146-59.00828-23.02342-22.92236-22.91378-59.00827-59.07302-23.27333-59.10554-33.03660-32.98712-32.97632-34.67800-33.03389-27.92880-28.06159-61.97374-62.11901-28.05350-40.05942-29.10605-28.01024-25.73689-59.04060-59.00827-25.99743-26.03420-26.02941-58.83137-25.74340-58.97190-34.71966-33.24681-35.27128-53.81150-56.11257-55.94906-29.91112-34.62200-33.36705-29.67168-28.03740-40.03182-30.57916-33.04532-33.62320-34.94962-34.86104-58.78692-34.77560-34.85150-59.01722-63.33918-60.91171-66.29727-66.02837')

#FILE_ID=$(echo $RESPONSE| grep 'file_id' | cut -d '=' -f 5 | cut -d ' ' -f 1)

FILE_ID=b8df9565-07ed-4042-86e6-e1ec6d06245b

echo $RESPONSE
 


# download the file and merge with instrumental
curl https://api.sonicapi.com/file/download?access_id=$SONIC_ACCESS_ID&file_id=$FILE_ID
ffmpeg -i $COMMITS_AUDIO_PATH -i $DRAKE_INSTRUMENTAL -filter_complex amerge -c:a libmp3lame -q:a 4 $2

